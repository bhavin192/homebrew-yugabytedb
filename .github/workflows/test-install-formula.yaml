name: "Test Formula installation"
on:
  push:
    branches:
    - java-fix
jobs:
  install-formula:
    runs-on: macos-latest
    steps:
    - uses: actions/checkout@v2
    - name: "Add yugabytedb tap and checkout development branch"
      run: |
        brew install coreutils
        brew tap yugabyte/yugabytedb file://$(pwd)
        brew install --build-from-source yugabyte/yugabytedb/yugabytedb
        which ysqlsh || true
        which ycqlsh || true
        which cqlsh || true
        gtimeout 10m yugabyted start --config /usr/local/etc/yugabyte.conf
        curl http://localhost:7200 || true
        curl http://localhost:9000 || true
        export PGPASSWORD="yugabyte"
        ysqlsh -h localhost -p 5433 -U yugabyte -d yugabyte -c "CREATE TABLE test1(id int primary key); INSERT INTO test1 SELECT * FROM generate_series(1,10); SELECT * FROM test1;"
        gtimeout 5m yugabyted demo connect --config /usr/local/etc/yugabyte.conf
        

